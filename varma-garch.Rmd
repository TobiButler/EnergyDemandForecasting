---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(rmgarch)
library(MTS)
library(forecast)
```


```{r}
training_data = read.csv(r"(clean_training_data.csv)", row.names = 1)
```

```{r}
colnames(training_data)
```


```{r}
head(training_data,5)
# training_data

# sapply(training_data, class)
```

```{r}
training_data["EnergyDemand"] <- msts(training_data["EnergyDemand"], seasonal.periods=c(24, 24*365.25))
```


Fit TBATS model to account for multiple seasonality periods
```{r}
tbats_model <- tbats(msts(training_data["EnergyDemand"], seasonal.periods=c(24, 24*365.25)), seasonal.periods = c(24, 24*365.25))
```

```{r}
plot(tbats_model)
```

Holtz-Winters
```{r}
# Assuming 'ts_data' is your hourly time series data
hw_model <- HoltWinters(msts(training_data["EnergyDemand"], seasonal.periods=c(24, 24*365.25)), seasonal = c("additive"), beta = TRUE)

```

Applying Differencing to remove trend, yearly seasonality, and daily seasonality
```{r}
ts_data <- training_data[["EnergyDemand"]]
yearly_period = 24*365.25
daily_period = 24
first_diffs <- diff(ts_data)
daily_diffs <- diff(first_diffs, lag = 24)
yearly_diffs <- diff(daily_diffs, lag = 365.25*24)

# reconstruct original time series
# reconstruct daily diffs
lags <- lag(yearly_diffs, 365.25*24)
lags <- lags[!is.na(lags)]
# lags
reconstructed_daily_diffs <- lags + yearly_diffs[]

# reconstruct first-order diffs
lags <- lag(reconstructed_daily_diffs, 24)
lags <- lags[!is.na(lags)]
# reconstructed_ts <- lags + reconstructed_diff_1
reconstructed_first_diffs <- lags + yearly_diffs
  
# reconstruct original time series
reconstructed_ts <- cumsum(reconstructed_first_diffs)
# reconstructed_ts
# 
# plot(ts_data)
plot(first_diffs)
# plot(daily_diffs)
# plot(yearly_diffs)
# plot(reconstructed_daily_diffs)
plot(reconstructed_first_diffs)
# plot(reconstructed_ts)
```




```{r}
mstl_model <- mstl(msts(training_data["EnergyDemand"], seasonal.periods=c(24, 24*365.25)))
```


```{r}
autoplot(mstl_model)
```

Extract the remainder to model using VARMA-GARCH
```{r}
energy_demand_residuals <- mstl_model[,"Remainder"]
plot(energy_demand_residuals)
# mstl_model[,"Remainder"]
```



```{r}
varma_model <- VARMA(training_data[1:4], p = 1, q = 1, include.mean = T)
```

